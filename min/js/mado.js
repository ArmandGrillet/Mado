/* Copyright (c) 2014 Armand Grillet.
See the license in the "About" section for further information. */
function contentChanged(){0==lastMarkdownHeight?lastMarkdownHeight=markdown.scrollHeight:lastMarkdownHeight<markdown.scrollHeight&&toTheBottom(),conversion(),markdown.clientHeight<markdown.scrollHeight?$(centerLine).css("display","none"):$(centerLine).css("display","block")}function errorHandler(){void 0!=fileInLoading&&(removeFile(fileInLoading),fileInLoading=void 0)}function exportFileHTML(){marked(markdown.value,function(a,b){chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:minFileName(nameDiv.innerHTML)+".html"},function(a){a&&a.createWriter(function(a){a.write(new Blob([b],{type:"text/HTML"}))},errorHandler)})})}function fileName(a){return a.substring(a.lastIndexOf("/")+1)}function minFileName(a){return""==a?"document":a.substring(a.lastIndexOf("/")+1,a.lastIndexOf("."))}function moreWindow(a){sendEvent("Window '"+a+"' opened"),chrome.app.window.create(a,{bounds:{left:Math.round(window.screenX+($(window).width()-498)/2),top:Math.round(window.screenY+($(window).height()-664)/2),width:498,height:664},frame:"none",minWidth:498,minHeight:664,maxWidth:498,maxHeight:664}),moreButton.click()}function newDisplaySize(){chrome.storage.local.get("displaySize",function(a){void 0!=a.displaySize?"small"==a.displaySize?$("body").attr("class","small"):"medium"==a.displaySize?$("body").attr("class"," "):$("body").attr("class","big"):(chrome.storage.local.set({displaySize:"medium"}),$("body").attr("class"," "))})}function newWindow(){sendEvent("New file"),markdown.value.length>0&&markdown.value!=firstMessage?chrome.app.window.create("mado.html",{bounds:{left:window.screenX+20,top:window.screenY+20,width:window.innerWidth,height:window.innerHeight},frame:"none",minWidth:theMinWidth(),minHeight:330}):markdown.value==firstMessage&&(markdown.value="",contentChanged(),$(markdown).focus())}function openFile(a){sendEvent("File opened"),a.file(function(b){var c=new FileReader;c.onload=function(b){""!=markdown.value?chrome.storage.local.set({tempFileEntry:chrome.fileSystem.retainEntry(a)},newWindow):(markdown.value=b.target.result,fileEntry=a,markdownSaved=markdown.value,contentChanged(),nameDiv.innerHTML=fileName(a.fullPath)+"&nbsp;-",windowTitle.innerHTML=fileName(a.fullPath)+" - Mado"),newRecentFile(a)},c.readAsText(b)},errorHandler)}function openFileButton(){chrome.fileSystem.chooseEntry({type:"openFile",accepts:[{extensions:["markdown","md","txt"]}]},function(a){a&&openFile(a)})}function saveAsFile(){chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:"document.md"},function(a){a&&a.createWriter(function(b){truncated=!1,b.onwriteend=function(){return truncated?(fileEntry=a,newRecentFile(fileEntry),markdownSaved=markdown.value,checkSaveState(),nameDiv.innerHTML=fileName(a.fullPath)+"&nbsp;-",void(windowTitle.innerHTML=fileName(fileToOpen.fullPath)+" - Mado")):(truncated=!0,void this.truncate(this.position))},b.write(new Blob([markdown.value],{type:"plain/text"}))},errorHandler)})}function saveFile(){void 0==fileEntry||"md&nbsp;-"!=nameDiv.innerHTML.substring(nameDiv.innerHTML.length-9)?saveAsFile():fileEntry.createWriter(function(a){truncated=!1,a.onwriteend=function(){return truncated?(newRecentFile(fileEntry),markdownSaved=markdown.value,void checkSaveState()):(truncated=!0,void this.truncate(this.position))},a.write(new Blob([markdown.value],{type:"plain/text"}))},errorHandler)}function theMinWidth(){return 750}function DnDManager(a,b){var c=document.querySelector(a),d=0;this.dragenter=function(a){a.stopPropagation(),a.preventDefault(),d++,c.classList.add("dropping")},this.dragover=function(a){dragMessageAlreadyVisible||(documentSection.className="dragging",dragMessageAlreadyVisible=1),a.stopPropagation(),a.preventDefault()},this.dragleave=function(a){documentSection.removeAttribute("class"),dragMessageAlreadyVisible=0,a.stopPropagation(),a.preventDefault(),--d<=0&&(c.classList.remove("dropping"),d=0)},this.drop=function(a){documentSection.removeAttribute("class"),dragMessageAlreadyVisible=0,a.stopPropagation(),a.preventDefault(),c.classList.remove("dropping"),b(a.dataTransfer)},c.addEventListener("dragenter",this.dragenter,!1),c.addEventListener("dragover",this.dragover,!1),c.addEventListener("dragleave",this.dragleave,!1),c.addEventListener("drop",this.drop,!1)}function openDraggedFile(a){filePath=a.fullPath,-1!=extensionsAllowed.indexOf(filePath.substring(filePath.lastIndexOf("."),filePath.length))&&openFile(a)}function conversion(){markdown.value.length>0?(void 0==editorSyntax?chrome.storage.local.get("gfm",function(a){void 0!=a.gfm?marked.setOptions({gfm:a.gfm}):(chrome.storage.local.set({gfm:!0}),marked.setOptions({gfm:!0})),setEditorSyntax()}):marked.setOptions({gfm:editorSyntax}),marked(markdown.value,function(a,b){imagePosition=0;for(var c=0;c<imagesArray.length;c++)imagesArray[c][2]=!1;tempConversion=b,displayImages()})):(conversionDiv.innerHTML="See the result here",resetCounter(),checkSaveState())}function checkDiv(a,b,c,d){return openDiv=b.indexOf("<div",c),closeDiv=b.indexOf("</div>",c),-1!=closeDiv?-1!=openDiv&&closeDiv>openDiv?checkDiv(a+1,b,openDiv+5,d):1==a?(newCE=b.substring(0,b.indexOf('<div id="'+d+'">')),newCE+=b.substring(b.indexOf('<div id="'+d+'">')+('<div id="'+d+'">').length,closeDiv),newCE+=b.substring(closeDiv+6),[0,newCE]):checkDiv(a-1,b,closeDiv+6,d):[-1]}function endOfConversion(){imagePath=void 0,rightFile=void 0;for(var a=0;a<imagesArray.length;a++)0==imagesArray[a][2]&&(imagesArray=imagesArray.splice(imagesArray[a],1));conversionDiv.innerHTML=tempConversion,$("#html-conversion a").each(function(){"#"!=$(this).attr("href").substring(0,1)&&"http"!=$(this).attr("href").substring(0,4)&&$(this).attr("href","http://"+$(this).attr("href")),$(this).attr("target","_blank")}),$("#html-conversion .nofile, #html-conversion .nofile-link, #html-conversion .nofile-visual").on("click",chooseGalleries),Countable.once(conversionDiv,function(a){displayCounter(a)},{stripTags:!0}),checkSaveState()}function setEditorSyntax(){chrome.storage.local.get("gfm",function(a){void 0!=a.gfm?editorSyntax=a.gfm:(chrome.storage.local.set({gfm:!0}),editorSyntax=!0),contentChanged()})}function searchOther(a){a?searchPositionCase++:searchPositionCase--,0>searchPositionCase?searchPositionCase=searchPositions.length-1:searchPositionCase>=searchPositions.length&&(searchPositionCase=0),$(markdown).setRange(searchPositions[searchPositionCase],searchPositions[searchPositionCase]+searchedWord.length)}function searchWord(a){if(searchedWord=a,searchPosition=-1,searchPositions=[],""!=searchedWord){for(;markdown.value.indexOf(searchedWord,searchPosition+1)>-1;)searchPosition=markdown.value.indexOf(searchedWord,searchPosition+1),searchPositions.push(searchPosition);searchPositions.length>0&&(searchPositionCase=0,$(markdown).setRange(searchPositions[searchPositionCase],searchPositions[searchPositionCase]+searchedWord.length))}}function counterSelection(){"none"==charsDiv.style.display?($(charsDiv).css("display","inline"),$(wordsDiv).css("display","none"),sendEvent("Number of chars diplayed")):($(charsDiv).css("display","none"),$(wordsDiv).css("display","inline"),sendEvent("Number of words diplayed"))}function displayCounter(a){charsDiv.innerHTML="&nbsp;"+a.characters+" characters&nbsp;",wordsDiv.innerHTML="&nbsp;"+a.words+" words&nbsp;",1==a.characters&&(charsDiv.innerHTML="&nbsp;"+a.characters+" character&nbsp;"),1==a.words&&(wordsDiv.innerHTML="&nbsp;"+a.words+" word&nbsp;")}function resetCounter(){charsDiv.innerHTML="&nbsp;0 characters&nbsp;",wordsDiv.innerHTML="&nbsp;0 words&nbsp;"}function answer(){maxAnswers=0;for(var a=0;a<helpArray.length&&3>maxAnswers;a++)for(var b=0;b<helpArray[a][0].length;b++)helpArray[a][0][b].toLowerCase().indexOf(help.value.toLowerCase())>-1&&(wordPos=helpArray[a][0][b].toLowerCase().indexOf(help.value.toLowerCase()),document.getElementById("answer-"+(maxAnswers+1)).innerHTML='<h1 class="help-title">'+helpArray[a][0][b].substring(0,wordPos)+'<span class="match">'+helpArray[a][0][b].substr(wordPos,help.value.length)+"</span>"+helpArray[a][0][b].substring(wordPos+help.value.length)+"</h1>"+helpArray[a][1],document.getElementById("example-"+(maxAnswers+1)).innerHTML=helpArray[a][2],maxAnswers++,b=helpArray[a][0].length);switch(maxAnswers){case 0:document.getElementById("answer-1").innerHTML="No help found.",resultsContainer.className="one-result no-result",resetAnswerDiv(2);break;case 1:resultsContainer.className="one-result",resetAnswerDiv(2);break;case 2:resultsContainer.className="two-results",resetAnswerDiv(3);break;case 3:resultsContainer.className="three-results"}}function displayAnswers(){for(var a=1;3>=a;a++)"result switched"==document.getElementById("result-"+a).className&&(document.getElementById("result-"+a).className="result");if(0==help.value.length)resultsContainer.className="hidden",resetAnswerDiv(3),setResultsHeight();else if(help.value.length<3){switch(resultsContainer.className="one-result no-result",resetAnswerDiv(2),help.value.length){case 1:document.getElementById("answer-1").innerHTML="Add two more characters";break;case 2:document.getElementById("answer-1").innerHTML="Add one more character"}setResultsHeight()}else answer()}function resetAnswerDiv(a){for(var b=a;3>=b;b++)""==document.getElementById("answer-"+b).innerHTML?b=3:(document.getElementById("answer-"+b).innerHTML="",document.getElementById("result-"+b).className="result",document.getElementById("example-"+b).innerHTML="")}function setResultsHeight(){for(var a=0,b=1;3>=b;b++)""!=$("#answer-"+b).html()?($("#result-"+b).css("display","block"),$("#answer-"+b).outerHeight()>=$("#example-"+b).outerHeight()?$("#result-"+b).css("height",$("#answer-"+b).outerHeight()+"px"):$("#result-"+b).css("height",$("#example-"+b).outerHeight()+"px"),a+=$("#result-"+b).outerHeight()):($("#result-"+b).css("height",0),$("#result-"+b).css("display","none"));$(resultsContainer).css("height",a+"px")}function switchResult(a){document.getElementById("result-"+a).className="result"==document.getElementById("result-"+a).className?"result switched":"result",help.focus()}function applyImage(){""==altInput.value?(altInput.setAttribute("class","flash"),altInput.focus(),altInput.removeAttribute("class")):void 0!=imageLoaded&&(imageDisplayer.className="tool-displayer hidden",markdown.focus(),$(markdown).setRange(startSelect,newEndSelect))}function cancelImage(){markdown.value=markdown.value.substring(0,startSelect)+initialText+markdown.value.substring(newEndSelect,markdown.length),contentChanged(),imageDisplayer.className="tool-displayer hidden",markdown.focus(),$(markdown).setRange(startSelect,endSelect)}function chooseGalleries(){chrome.mediaGalleries.getMediaFileSystems({interactive:"yes"},update)}function chromeUpdate(a){galleriesList=a,galleryAnalysis(0)}function displayImages(){if(tempConversion.indexOf('<img src="',imagePosition)>-1){imagePosition=tempConversion.indexOf('<img src="',imagePosition)+10,researching=!1,imagePath=tempConversion.substring(imagePosition,tempConversion.indexOf('"',imagePosition)),imagePathsArray.length=0;for(var a=0;a<imagesArray.length;a++)imagePathsArray.push(imagesArray[a][0]);imagePositionInArray=imagePathsArray.indexOf(imagePath),imgFormats.indexOf(imagePath.substr(imagePath.lastIndexOf(".")+1).toLowerCase())>-1?("http://"==imagePath.substring(0,7)||"https://"==imagePath.substring(0,8)?navigator.onLine?imagePositionInArray>-1?(tempConversion=tempConversion.substring(0,imagePosition)+imagesArray[imagePositionInArray][1]+tempConversion.substring(imagePosition+imagePath.length),imagesArray[imagePositionInArray][2]=!0):(researching=!0,updateOnline(imagePath)):tempConversion=tempConversion.substring(0,imagePosition-10)+'<span class="nofile-link"> <span class="nofile-visual">Internet not available</span>&nbsp;</span><img class="nofile" srcset="img/nointernet.png 1x, img/nointernet@2x.png 2x'+tempConversion.substring(imagePosition+imagePath.length):"data:"!=imagePath.substring(0,5)&&"blob:"!=imagePath.substring(0,5)&&(imagePositionInArray>-1?(tempConversion=tempConversion.substring(0,imagePosition)+imagesArray[imagePositionInArray][1]+tempConversion.substring(imagePosition+imagePath.length),imagesArray[imagePositionInArray][2]=!0):(researching=!0,rightFile=!1,update())),researching||displayImages()):"data:"!=imagePath.substring(0,5)&&"blob:"!=imagePath.substring(0,5)&&(tempConversion=tempConversion.substring(0,imagePosition-10)+'<span class="nofile-link"> <span class="nofile-visual">This is not an image</span>&nbsp;</span><img class="nofile" srcset="img/notimage.png 1x, img/notimage@2x.png 2x'+tempConversion.substring(imagePosition+imagePath.length),displayImages())}else endOfConversion()}function fileNotFound(){tempConversion=tempConversion.substring(0,imagePosition-10)+'<span class="nofile-link"> <span class="nofile-visual">'+fileName(imagePath.replace(/\\/g,"/"))+' not found</span>&nbsp;</span><img class="nofile" srcset="img/nofile.png 1x, img/nofile@2x.png 2x'+tempConversion.substring(imagePosition+imagePath.length),-1!=tempConversion.indexOf('<img src="',imagePosition)?displayImages():endOfConversion()}function galleryAnalysis(a){rightFile?(imagesArray.length=0,modifyImage()):a<galleriesList.length?(currentGallery=a,galleriesList.forEach(function(b,c){c==a&&void 0!=imagePath&&0==rightFile&&b.root.createReader().readEntries(getImages)})):fileNotFound()}function getImage(a){galleriesList[currentGallery].root.getFile(a,{create:!1},function(a){a.file(function(a){var b=new FileReader;b.onloadend=function(){imagesArray.push([imagePath,this.result,!0]),tempConversion=tempConversion.substring(0,imagePosition)+this.result+tempConversion.substring(imagePosition+imagePath.length),rightFile=!0,-1!=tempConversion.indexOf('<img src="',imagePosition)?displayImages():endOfConversion()},b.readAsDataURL(a)})})}function getImages(a){for(var b=0;b<a.length&&0==rightFile;b++){if(a[b].isDirectory&&-1!=imagePath.indexOf(a[b].fullPath)){a[b].createReader().readEntries(getImages);break}if(-1!=imagePath.indexOf(a[b].fullPath)){getImage(a[b].fullPath);break}b==a.length-1&&galleryAnalysis(currentGallery+1)}}function loadImage(){chrome.fileSystem.chooseEntry({type:"openFile",accepts:[{mimeTypes:["image/*"]}]},function(a){a&&chrome.fileSystem.getDisplayPath(a,function(a){setImageBrowserText(fileName(a.replace(/\\/g,"/"))),imageLoaded=a.replace(/\\/g,"/"),modifyImage(),altInput.focus()})})}function modifyImage(){image="!["+altInput.value+"]("+imageLoaded+")",void 0!=imageDiv?imageDiv.innerText=image:$(markdown).innerText=$(markdown).innerText+image,void 0==newEndSelect&&(newEndSelect=endSelect),markdown.value=markdown.value.substring(0,startSelect)+image+markdown.value.substring(newEndSelect,markdown.length),newEndSelect=(markdown.value.substring(0,startSelect)+image).length,contentChanged()}function setImageBrowserText(a){imageBrowser.innerHTML=a,imageBrowser.innerHTML.length>15&&(imageBrowser.innerHTML=imageBrowser.innerHTML.substring(0,6)+"(…)"+imageBrowser.innerHTML.substring(imageBrowser.innerHTML.length-6,imageBrowser.innerHTML.length))}function setImageInputs(){initialText=markdown.value.substring(startSelect,endSelect),/!\[.*\]\(.*\)/.test(initialText)&&"!"==initialText[0]&&")"==initialText[initialText.length-1]?(imageLoaded=/!\[.*\]\(.*\s+".*"\)/.test(initialText)?initialText.match(/\(.*\)/)[0].substring(2,initialText.match(/\(.*\s+"/)[0].length-2).replace(/\\/g,"/"):initialText.match(/\(.*\)/)[0].substring(2,initialText.match(/\(.*\)/)[0].length-1).replace(/\\/g,"/"),setImageBrowserText(fileName(imageLoaded)),altInput.value=initialText.match(/!\[.+\]/)[0].substring(2,initialText.match(/!\[.+\]/)[0].length-1)):altInput.value=initialText,$(markdown).setRange(startSelect,newEndSelect)}function update(){chrome.mediaGalleries.getMediaFileSystems({interactive:"no"},chromeUpdate)}function applyLink(){""==urlInput.value?(urlInput.setAttribute("class","tool-first-item flash"),urlInput.focus(),urlInput.setAttribute("class","tool-first-item")):(linkDisplayer.className="tool-displayer hidden",markdown.focus(),$(markdown).setRange(startSelect,newEndSelect))}function cancelLink(){markdown.value=markdown.value.substring(0,startSelect)+initialText+markdown.value.substring(newEndSelect,markdown.length),contentChanged(),linkDisplayer.className="tool-displayer hidden",markdown.focus(),$(markdown).setRange(startSelect,endSelect)}function modifyLink(){link=""==hypertextInput.value?"["+urlInput.value+"]("+urlInput.value+")":"["+hypertextInput.value+"]("+urlInput.value+")",void 0==newEndSelect&&(newEndSelect=endSelect),markdown.value=markdown.value.substring(0,startSelect)+link+markdown.value.substring(newEndSelect,markdown.length),newEndSelect=(markdown.value.substring(0,startSelect)+link).length,contentChanged()}function setLinkInputs(){initialText=markdown.value.substring(startSelect,endSelect),/\[.*\]\(.*\)/.test(initialText)&&"["==initialText[0]&&")"==initialText[initialText.length-1]?(hypertextInput.value=initialText.match(/\[.*\]/)[0].substring(1,initialText.match(/\[.*\]/)[0].length-1),urlInput.value=initialText.match(/\(.*\)/)[0].substring(1,initialText.match(/\(.*\)/)[0].length-1)):hypertextInput.value=initialText,$(markdown).setRange(startSelect,newEndSelect)}function applyOnlineImage(){""==onlineImageUrlInput.value?(onlineImageUrlInput.setAttribute("class","tool-first-item flash"),onlineImageUrlInput.focus(),onlineImageUrlInput.setAttribute("class","tool-first-item")):(onlineImageDisplayer.className="tool-displayer hidden",markdown.focus(),$(markdown).setRange(startSelect,newEndSelect))}function cancelOnlineImage(){markdown.value=markdown.value.substring(0,startSelect)+initialText+markdown.value.substring(newEndSelect,markdown.length),contentChanged(),onlineImageDisplayer.className="tool-displayer hidden",markdown.focus(),$(markdown).setRange(startSelect,endSelect)}function modifyOnlineImage(){onlineImage=""==onlineImageAltInput.value?"!["+onlineImageUrlInput.value+"]("+onlineImageUrlInput.value+")":"!["+onlineImageAltInput.value+"]("+onlineImageUrlInput.value+")",void 0==newEndSelect&&(newEndSelect=endSelect),markdown.value=markdown.value.substring(0,startSelect)+onlineImage+markdown.value.substring(newEndSelect,markdown.length),newEndSelect=(markdown.value.substring(0,startSelect)+onlineImage).length,contentChanged()}function setOnlineImageInputs(){initialText=markdown.value.substring(startSelect,endSelect),/!\[.*\]\(.*\)/.test(initialText)&&"!"==initialText[0]&&")"==initialText[initialText.length-1]?(onlineImageAltInput.value=initialText.match(/!\[.*\]/)[0].substring(2,initialText.match(/!\[.*\]/)[0].length-1),onlineImageUrlInput.value=initialText.match(/\(.*\)/)[0].substring(1,initialText.match(/\(.*\)/)[0].length-1)):onlineImageAltInput.value=initialText,$(markdown).setRange(startSelect,newEndSelect)}function updateOnline(){loadOnlineImage(imagePath,function(a){tempConversion=tempConversion.replace(imagePath,a),imagesArray.push([imagePath,a,!0]),-1!=tempConversion.indexOf('<img src="',imagePosition)?displayImages():endOfConversion()})}function checkRecentFile(a){7>=a&&chrome.storage.local.get(recentFiles,function(b){void 0!=b["recentFile"+a]&&chrome.fileSystem.isRestorable(b["recentFileId"+a],function(c){c?chrome.fileSystem.restoreEntry(b["recentFileId"+a],function(b){b?checkRecentFile(a+1):(document.getElementById("recent-"+a).setAttribute("class","recent-file deleted"),removeFileInStorage(a,"check"))}):(document.getElementById("recent-"+a).setAttribute("class","recent-file deleted"),removeFileInStorage(a,"check"))})})}function displayRecentFiles(){checkRecentFile(1),recentFilesContainer.innerHTML=" ",chrome.storage.local.get(recentFiles,function(a){for(var b=1;7>=b&&void 0!=a["recentFile"+b];b++)recentFilesContainer.innerHTML+='<li class="recent-file" id="recent-'+b+'"><div class="recent-file-wrapped"><p>'+fileName(a["recentFile"+b].toString())+'</p><div class="delete-recent-button little-icon-delete" id="delete-button-'+b+'"></div></div></li>';$(".recent-file").on("click",function(a){$(a.target).closest("#delete-button-"+this.id.charAt(this.id.length-1)).length||(fileInLoading=this.id.charAt(this.id.length-1).valueOf(),chromeLocalFile="recentFileId"+this.id.charAt(this.id.length-1),chrome.storage.local.get(chromeLocalFile,function(a){chrome.fileSystem.restoreEntry(a[chromeLocalFile],function(a){openFile(a),recentFilesDisplayer.className="hidden"})}))}),$(".delete-recent-button").on("click",function(){removeFile(this.id.charAt(this.id.length-1))}),footerHelp=document.createElement("li"),footerHelp.setAttribute("id","recent-files-info")," "!=recentFilesContainer.innerHTML?(footerHelp.setAttribute("class","clear-all"),footerHelp.innerHTML='<div class="icon-recent-clear"></div><span class="clear-all-text">Clear all</span>'):(footerHelp.setAttribute("class"," "),footerHelp.innerHTML="No recent document."),recentFilesContainer.appendChild(footerHelp),$(".clear-all").on("click",function(){removeAllFiles()})})}function newRecentFile(a,b){chrome.storage.local.get(recentFiles,function(c){for(var d=1;7>=d;d++)if(void 0==c["recentFile"+d]||c["recentFile"+d]==a.fullPath||7==d){for(var e=d;e>0;e--)e>1?(chromeLocalFile=("recentFileId"+e).toString(),nameContainer[chromeLocalFile]=c["recentFileId"+(e-1)],chrome.storage.local.set(nameContainer),nameContainer={},chromeLocalFile=("recentFile"+e).toString(),nameContainer[chromeLocalFile]=c["recentFile"+(e-1)],chrome.storage.local.set(nameContainer),nameContainer={}):(chrome.storage.local.set({recentFileId1:chrome.fileSystem.retainEntry(a)}),chrome.storage.local.set({recentFile1:a.fullPath}),displayRecentFiles(),void 0!=b&&"quit"==b&&quitCloseWindow());break}})}function removeFile(a){document.getElementById("recent-"+a).setAttribute("class","recent-file deleted"),setTimeout(function(){removeFileInStorage(a,"display")},100)}function removeFileInStorage(a,b){chrome.storage.local.get(recentFiles,function(c){if(void 0!=c["recentFile"+a]){for(var d=parseInt(a);7>=d;d++){if(void 0==c["recentFile"+(d+1)]){chromeLocalFile=("recentFileId"+d).toString(),chrome.storage.local.remove(chromeLocalFile),chromeLocalFile=("recentFile"+d).toString(),chrome.storage.local.remove(chromeLocalFile),chromeLocalFile="";break}chromeLocalFile=("recentFileId"+d).toString(),nameContainer[chromeLocalFile]=c["recentFileId"+(d+1)],chrome.storage.local.set(nameContainer),nameContainer={},chromeLocalFile=("recentFile"+d).toString(),nameContainer[chromeLocalFile]=c["recentFile"+(d+1)],chrome.storage.local.set(nameContainer),nameContainer={}}"display"==b?displayRecentFiles():"check"==b&&checkRecentFile(a)}})}function removeAllFiles(){chrome.storage.local.get(recentFiles,function(a){for(var b=1;7>=b;b++)if(void 0==a["recentFile"+(b+1)]){removeAllFilesInStorage(b);break}})}function removeAllFilesInStorage(a){chrome.storage.local.get(recentFiles,function(){chromeLocalFile=("recentFileId"+a).toString(),chrome.storage.local.remove(chromeLocalFile),chromeLocalFile=("recentFile"+a).toString(),chrome.storage.local.remove(chromeLocalFile),chromeLocalFile="",a>1?removeAllFilesInStorage(a-1):recentFilesContainer.innerHTML='<li id="recent-files-info" class=" ">No recent document.</li>'})}function addTopbarLabels(){$(exportButton).attr("title","Export"),$(newButton).attr("title","New"),$(openButton).attr("title","Open"),$(printButton).attr("title","Print"),$(recentButton).attr("title","Recent"),$(saveButton).attr("title","Save"),$(saveAsButton).attr("title","Save as")}function removeTopbarLabels(){$(exportButton).removeAttr("title"),$(newButton).removeAttr("title"),$(openButton).attr("title"),$(printButton).attr("title"),$(recentButton).attr("title"),$(saveButton).attr("title"),$(saveAsButton).attr("title")}function asyncScroll(a){"markdown"==a?$(conversionDiv).scrollTop($(markdown).scrollTop()/(markdown.scrollHeight-markdown.offsetHeight)*(conversionDiv.scrollHeight-conversionDiv.offsetHeight)):$(markdown).scrollTop($(conversionDiv).scrollTop()/(conversionDiv.scrollHeight-conversionDiv.offsetHeight)*(markdown.scrollHeight-markdown.offsetHeight)),atTheBottom=$(markdown).scrollTop()+markdown.offsetHeight==markdown.scrollHeight?!0:!1}function toTheBottom(){atTheBottom&&($(markdown).scrollTop(markdown.scrollHeight-markdown.offsetHeight),$(conversionDiv).scrollTop(conversionDiv.scrollHeight-conversionDiv.offsetHeight))}function initStats(){service=analytics.getService("Mado"),setTrackingPermission(),tracker=service.getTracker("UA-45134408-1"),tracker.sendAppView("mainWindow")}function newInputForStats(){markdownInputs++,markdownInputs%50==0&&sendEvent("50 inputs in the textarea")}function sendClosing(){void 0!=service&&void 0!=tracker&&navigator.onLine&&chrome.storage.local.get("analytics",function(a){0!=a.analytics&&tracker.sendEvent("Window lifetime","Window has been closed",(parseInt(((new Date).getTime()-launchDate.getTime())/1e3/60)+":"+parseInt(((new Date).getTime()-launchDate.getTime())/1e3%60)).toString())})}function sendEvent(a){void 0!=service&&void 0!=tracker&&navigator.onLine&&chrome.storage.local.get("analytics",function(b){0!=b.analytics&&tracker.sendEvent(a)})}function setTrackingPermission(){chrome.storage.local.get("analytics",function(a){void 0!=a.analytics?service.t.setTrackingPermitted(a.analytics):(chrome.storage.local.set({analytics:!0}),service.t.setTrackingPermitted(!0))})}function getStyle(){chrome.storage.local.get("style",function(a){if(void 0!=a.style){switch(a.style){case"home":homeRadio.checked=!0;break;case"clinic":clinicRadio.checked=!0;break;case"tramway":tramwayRadio.checked=!0}setStyleInHTML(a.style)}else homeRadio.checked=!0,setStyle("home")})}function setStyle(a){setStyleInHTML(a),chrome.storage.local.set({style:a})}function setStyleInHTML(a){for(var b=0;b<document.styleSheets.length;b++)-1!=document.styleSheets.item(b).href.indexOf("css/themes/")&&(document.styleSheets.item(b).disabled=-1==document.styleSheets.item(b).href.indexOf(a)?!0:!1)}function activate(a,b){for(var c=0;c<switchButtons.length;c++)switchButtons[c].className=switchButtons[c].id!=a?"switch-button":"switch-button activated";workspace.className=b,switchCursor.className=b,"markdown-view"==b?madoFooter.className=b:madoFooter.removeAttribute("class")}function initActivation(){chrome.app.window.current().getBounds().width>1159?switchToBoth.className="switch-button activated":(switchToMD.className="switch-button activated",workspace.className="markdown-view"),previousSize=chrome.app.window.current().getBounds().width}function switchShortcuts(a){if(window.innerWidth>1159)for(var b=0;b<switchButtons.length;b++)"switch-button activated"==switchButtons[b].className&&("left"==a&&b>0?switchButtons[b-1].click():"right"==a&&b<switchButtons.length-1&&switchButtons[b+1].click(),b=switchButtons.length);else"left"==a?switchToMD.click():switchToHTML.click()}function checkSaveState(){saveState.innerHTML=""!=markdown.value?void 0==markdownSaved||markdown.value!=markdownSaved?'<span class="little-icon-unsaved"></span>':"":void 0!=markdownSaved?'<span class="little-icon-unsaved"></span>':""}function closeWindow(){chrome.runtime.getBackgroundPage(function(a){a.newBounds(chrome.app.window.current().getBounds())}),'<span class="little-icon-unsaved"></span>'==saveState.innerHTML?closeDisplayer.className="visible":(sendClosing(),chrome.app.window.current().close())}function determineFrame(){frameStylesheetLink.setAttribute("rel","stylesheet"),frameStylesheetLink.setAttribute("type","text/css"),operatingSystem=navigator.appVersion.indexOf("Mac")>-1?"mac":navigator.appVersion.indexOf("Win")>-1?"windows":navigator.appVersion.indexOf("Linux")>-1?"linux":"chromeos",frameStylesheetLink.setAttribute("href","css/window-frame-"+operatingSystem+".css"),windowClose.setAttribute("class","cta little-icon-"+operatingSystem.substring(0,3)+"-close"),windowMax.setAttribute("class","cta little-icon-"+operatingSystem.substring(0,3)+"-maximize"),windowMin.setAttribute("class","cta little-icon-"+operatingSystem.substring(0,3)+"-minimize"),head.appendChild(frameStylesheetLink)}function maximizeWindow(){chrome.app.window.current().isMaximized()?chrome.app.window.current().restore():chrome.app.window.current().maximize()}function minimizeWindow(){chrome.app.window.current().minimize()}function quitCloseWindow(){sendClosing(),chrome.runtime.getBackgroundPage(function(a){a.newBounds(chrome.app.window.current().getBounds())}),chrome.app.window.current().close()}function saveAndQuit(){fileEntry.createWriter(function(a){truncated=!1,a.onwriteend=function(){return truncated?void newRecentFile(fileEntry,"quit"):(truncated=!0,void this.truncate(this.position))},a.write(new Blob([markdown.value],{type:"plain/text"}))},errorHandler)}function saveAsAndQuit(){chrome.fileSystem.chooseEntry({type:"saveFile",suggestedName:"document.md"},function(a){a&&a.createWriter(function(b){truncated=!1,b.onwriteend=function(){return truncated?void newRecentFile(a,"quit"):(truncated=!0,void this.truncate(this.position))},b.write(new Blob([markdown.value],{type:"plain/text"}))},errorHandler)})}function saveQuitCloseWindow(){void 0==fileEntry||"md&nbsp;-"!=nameDiv.innerHTML.substring(nameDiv.innerHTML.length-9)?saveAsAndQuit():saveAndQuit()}var exportButton,newButton,openButton,printButton,recentButton,saveButton,saveAsButton,windowTitle,fileEntry,lastMarkdownHeight=0,truncated;chrome.storage.onChanged.addListener(function(a){for(key in a)switch(key){case"analytics":setTrackingPermission();break;case"displaySize":newDisplaySize();break;case"gfm":setEditorSyntax()}}),$(document).click(function(a){$(a.target).closest(helpButton).length&&"tool-displayer hidden"==helpDisplayer.className?(helpDisplayer.className="tool-displayer",help.focus()):"tool-displayer hidden"==helpDisplayer.className||$(a.target).closest(help).length||$(a.target).closest(resultsContainer).length||(help.value="",resetAnswerDiv(1),resultsContainer.className="hidden",helpDisplayer.className="tool-displayer hidden"),$(a.target).closest(imageButton).length&&"tool-displayer hidden"==imageDisplayer.className?(imageBrowser.innerHTML="Choose an image",altInput.value="",initialText=markdown.value,imageLoaded=void 0,imageDisplayer.className="tool-displayer",markdown.selectionStart!=markdown.selectionEnd||$(markdown).is(":focus")?(startSelect=markdown.selectionStart,endSelect=markdown.selectionEnd):(startSelect=markdown.value.length,endSelect=markdown.value.length),startSelect!=endSelect&&markdown.setSelectionRange(startSelect,endSelect),newEndSelect=endSelect,setImageInputs()):"tool-displayer"!=imageDisplayer.className||$(a.target).closest(imageBox).length&&!$(a.target).closest(document.getElementById("insert-image")).length||($(a.target).closest(document.getElementById("insert-image")).length?applyImage():imageDisplayer.className="tool-displayer hidden"),$(a.target).closest(linkButton).length&&"tool-displayer hidden"==linkDisplayer.className?(urlInput.value="",hypertextInput.value="",initialText=markdown.value,linkDisplayer.className="tool-displayer",markdown.selectionStart!=markdown.selectionEnd||$(markdown).is(":focus")?(startSelect=markdown.selectionStart,endSelect=markdown.selectionEnd):(startSelect=markdown.value.length,endSelect=markdown.value.length),startSelect!=endSelect&&markdown.setSelectionRange(startSelect,endSelect),newEndSelect=endSelect,setLinkInputs(),urlInput.focus()):"tool-displayer"!=linkDisplayer.className||$(a.target).closest(linkDisplayer).length&&!$(a.target).closest(document.getElementById("insert-link")).length||($(a.target).closest(document.getElementById("insert-link")).length?applyLink():linkDisplayer.className="tool-displayer hidden"),$(a.target).closest(moreButton).length&&"hidden"==moreDisplayer.className?moreDisplayer.className=" ":"hidden"==moreDisplayer.className||$(a.target).closest(moreBox).length||(moreDisplayer.className="hidden"),$(a.target).closest(onlineImageButton).length&&"tool-displayer hidden"==onlineImageDisplayer.className?(onlineImageDisplayer.className="tool-displayer",onlineImageUrlInput.value="",onlineImageAltInput.value="",initialText=markdown.value,onlineImageDisplayer.className="tool-displayer",markdown.selectionStart!=markdown.selectionEnd||$(markdown).is(":focus")?(startSelect=markdown.selectionStart,endSelect=markdown.selectionEnd):(startSelect=markdown.value.length,endSelect=markdown.value.length),startSelect!=endSelect&&markdown.setSelectionRange(startSelect,endSelect),newEndSelect=endSelect,setOnlineImageInputs(),onlineImageUrlInput.focus()):"tool-displayer"!=onlineImageDisplayer.className||$(a.target).closest(onlineImageDisplayer).length&&!$(a.target).closest(document.getElementById("insert-webimage")).length||($(a.target).closest(document.getElementById("insert-webimage")).length?applyOnlineImage():onlineImageDisplayer.className="tool-displayer hidden"),$(a.target).closest(recentButton).length&&"hidden"==recentFilesDisplayer.className?(displayRecentFiles(),recentFilesDisplayer.className=""):"hidden"==recentFilesDisplayer.className||$(a.target).closest(recentFilesContainer).length||(recentFilesDisplayer.className="hidden"),$(a.target).closest(stylesButton).length&&"tool-displayer hidden"==stylesDisplayer.className?stylesDisplayer.className="tool-displayer":"tool-displayer hidden"==stylesDisplayer.className||$(a.target).closest(stylesDisplayer).length||(stylesDisplayer.className="tool-displayer hidden"),"visible"!=closeDisplayer.className||$(a.target).closest(windowCloseContainer).length&&!$(a.target).closest(cancelCloseButton).length||(closeDisplayer.className="hidden")
});var documentSection,dragAndDropManager,dragMessageAlreadyVisible=!1,extensionsAllowed=[".markdown",".md",".txt"],filePath,centerLine,conversionDiv,markdown,pasteZone,closeDiv,editorSyntax,firstMessage="# Dear user,\n\nThanks for installing **Mado**. For your first launch, here is some information:\n\n* Mado handles .md, .markdown and .txt files, can save these files as .md (the official extension for MarkDown files) and offers an export in .html.\n* You can click the number of words in the bottom-right corner to see the number of characters in your document (and *vice versa*). Click the eye icon next to it to change the style of the HTML view.\n* Mado uses Google Analytics to know in real time how many users are currently running the app, for statistical analysis only. You can deactivate it anytime in the settings (top-right button, “Settings” section).\n* See the keyboard shortcuts (top-right button, “Shortcuts” section) to use Mado in depth.\n\nWe hope you will enjoy Mado,\n\n**[A+A](https://twitter.com/AplusA_io)**\n\n***\n\nP.S. This message will not appear anymore. Click “New” in the navbar to start using Mado.",initialText,newCE,openDiv,optiMarkdown,tempConversion,tempMarkdown,starSelect,endSelect,newEndSelect,newRange;$.fn.setRange=function(a,b){return b||(b=a),this.each(function(){this.setSelectionRange?(this.focus(),this.setSelectionRange(a,b)):this.createTextRange&&(newRange=this.createTextRange(),range.collapse(!0),range.moveEnd("character",b),range.moveStart("character",a),range.select())})};var searchPosition=-1,searchPositions=[],searchPositionCase,searchedWord,charsDiv,linkUrlSpan,nameDiv,wordsDiv,answersContainer,help,helpButton,helpDisplayer,maxAnswers,resultsContainer,wordPos,helpArray=[[["Headers","Titles"],"Six sizes available, the size depends on the numbers of #. <br> #Big title (size 1, the biggest). <br> ####A less impresive title (size 4 on 6).",'Six sizes available, the size depends on the numbers of #.<h1 id="big-title-size-1-the-biggest-">Big title (size 1, the biggest).</h1><h4 id="a-less-impresive-title-size-4-on-6-br-">A less impresive title (size 4 on 6).</h4>'],[["Bold","Strong emphasis"],'<span class="help-code">**bold**</span> or <span class="help-code">__bold__</span>',"<strong>Bold</strong>"],[["Italic","Emphasis"],'<span class="help-code">*italic*</span> or <span class="help-code">_italic_</span>',"<em>Italic</em>"],[["Bold italic","Combined emphasis"],'<span class="help-code">**_ bold italic_**</span> or <span class="help-code">*__bold italic__*</span> or <span class="help-code">***this***</span> or <span class="help-code">___this___</span>',"<strong><em>Bold italic</em></strong>"],[["Ordered lists"],"1. First ordered list item. <br>2. Another item.","<ol><li>First ordered list item</li><li>Another item.</li></ol>"],[["Unordered lists"],"* An item. <br>* A second item (you can also use + or -).","<ul><li>An item. </li><li>A second item (you can also use + or -).</li></ul>"],[["Inline-style links"],'<span class="help-code">[Hypertext](http://aplusa.io/mado)</span><br>(Can be used to create an anchor.)','<a target="_blank" href="http://aplusa.io/mado">Hypertext</a>'],[["Reference-style links"],'<span class="help-code">[Hypertext][1]<br>[1]: http://aplusa.io/mado</span>','<a target="_blank" href="http://aplusa.io/mado">Hypertext</a>'],[["Images (inline)","Pictures (inline)"],'<span class="help-code">![alt text](path/to/image.jpg "Title")</span>','<div class="example-image"></div>'],[["Images (reference-style)","Pictures (reference-style)"],'<span class="help-code">![alt text][image Id] <br> [image Id]: path/to/image.jpg "Title"</span>','<div class="example-image"></div>'],[["Blocks of code"],'<span class="help-code">```Text between three back-ticks is a block of code.```<br>&nbsp;&nbsp;&nbsp;&nbsp;Text after four spaces is also a block of code.</span>',"<code>Write your code between three back-ticks to make a block of code.</code><br><code>You can also write code by indent your text with four spaces.</code>"],[["Blockquotes"],'> Blockquotes only need <span class="help-code">></span> to work. <br><br> <span class="help-code">> Two blockquotes without a break (a line who isn\'t a blockquote)  are a single quote.</span>',"<blockquote>Blockquotes only need &gt; to work. To separate two blockquotes, insert a blank line between them.</blockquote>"],[["Inline HTML","HTML in Markdown"],'<span class="help-code">It &lt;strong>works&lt;/strong>.</span>',"It <strong>works<strong>"],[["Horizontal rules"],'<span class="help-code">*** <br> You can use Hyphens, asterisks or underscores. <br> ---</span>',"<hr> You can use Hyphens, asterisks or underscores.<hr>"],[["Line breaks"],'To separate two paragraphs, press <span class="help-code">Enter</span> twice.<br><br>And you have a new paragraph.',"<p>To separate two paragraphs, press Enter twice.</p><p>And you have a new paragraph!</p>"],[["Tables","Arrays"],"| Tables&nbsp; | Are&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Cool&nbsp;&nbsp;|<br>| -------- |:----------------:| ------:|<br>| col 3 is | right-aligned | $13 &nbsp;&nbsp; |<br>| col 2 is | centered&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | $37 &nbsp;&nbsp; |",'<table> <thead><tr> <th>Tables</th> <th align="center">Are</th> <th align="right">Cool</th> </tr></thead> <tbody> <tr> <td>col 3 is</td> <td align="center">right-aligned</td> <td align="right">$13</td> </tr> <tr> <td>col 2 is</td> <td align="center">centered</td> <td align="right">$37</td> </tr> </tbody> </table>'],[["Question"],"Seriously?","Life's most persistent and urgent question is, 'What are you doing for others?'."]],altInput,cancelImageButton,galleriesButton,imageButton,imageBox,imageBrowser,imageDisplayer,imageDiv,currentGallery,galleriesList=[],image,imageLoaded,imagePath,imagePosition=0,imagesArray=[],imgFormats=["png","bmp","jpeg","jpg","gif","png","svg","xbm","webp"],rightFile,researching,imagePathsArray=[],imagePositionInArray,cancelLinkButton,hypertextInput,link,linkButton,linkDisplayer,urlInput,linkDiv,moreButton,moreDisplayer,moreBox,settingsLine,qAndALine,shortcutsLine,aboutLine,onlineImageButton,onlineImageBox,onlineImageDisplayer,onlineImageUrlInput,onlineImageAltInput,onlineImage,loadOnlineImage=function(a,b){var c=new XMLHttpRequest;c.responseType="blob",c.onload=function(){b(window.URL.createObjectURL(c.response),a)},c.open("GET",a,!0),c.send()};window.onload=function(){exportButton=document.getElementById("export"),newButton=document.getElementById("new"),openButton=document.getElementById("open"),printButton=document.getElementById("print"),recentButton=document.getElementById("recent"),saveButton=document.getElementById("save"),saveAsButton=document.getElementById("save-as"),windowTitle=document.getElementsByTagName("title")[0],documentSection=document.getElementById("document"),centerLine=document.getElementById("center-line-container"),conversionDiv=document.getElementById("html-conversion"),markdown=document.getElementById("markdown"),pasteZone=document.getElementById("paste-zone"),charsDiv=document.getElementById("character-nb"),linkUrlSpan=document.getElementById("link-url"),nameDiv=document.getElementById("doc-name"),wordsDiv=document.getElementById("word-nb"),help=document.getElementById("help-input"),helpButton=document.getElementById("help-button"),helpDisplayer=document.getElementById("help-input-displayer"),resultsContainer=document.getElementById("help-results-container"),cancelImageButton=document.getElementById("cancel-image"),galleriesButton=document.getElementById("galleries-button"),imageButton=document.getElementById("image-button"),imageDisplayer=document.getElementById("image-insertion-displayer"),imageBox=document.getElementById("image-insertion-box"),imageBrowser=document.getElementById("browse-image"),altInput=document.getElementById("alt-input"),cancelLinkButton=document.getElementById("cancel-link"),linkButton=document.getElementById("link-button"),linkDisplayer=document.getElementById("link-insertion-displayer"),urlInput=document.getElementById("url-input"),hypertextInput=document.getElementById("hypertext-input"),moreButton=document.getElementById("more-button"),moreDisplayer=document.getElementById("more-displayer"),moreBox=document.getElementById("more-container"),settingsLine=document.getElementById("settings"),qAndALine=document.getElementById("q-and-a"),shortcutsLine=document.getElementById("shortcuts"),aboutLine=document.getElementById("about"),cancelOnlineImageButton=document.getElementById("cancel-webimage"),onlineImageButton=document.getElementById("webimage-button"),onlineImageUrlInput=document.getElementById("webimage-url"),onlineImageAltInput=document.getElementById("webimage-alt-input"),onlineImageDisplayer=document.getElementById("webimage-insertion-displayer"),onlineImageBox=document.getElementById("webimage-insertion-box"),recentButton=document.getElementById("recent-button"),recentFilesDisplayer=document.getElementById("recent-files-displayer"),recentFilesContainer=document.getElementById("recent-files-container"),stylesButton=document.getElementById("style-tool"),stylesDisplayer=document.getElementById("style-tool-displayer"),homeRadio=document.getElementById("home-style"),clinicRadio=document.getElementById("clinic-style"),tramwayRadio=document.getElementById("tramway-style"),madoFooter=document.getElementById("mado-footer"),workspace=document.getElementById("workspace"),switchCursor=document.getElementById("switch-cursor"),switchToMD=document.getElementById("switch-md"),switchToBoth=document.getElementById("switch-both"),switchToHTML=document.getElementById("switch-html"),switchButtons.push(switchToMD,switchToBoth,switchToHTML),cancelCloseButton=document.getElementById("cancel"),closeDisplayer=document.getElementById("close-alert-displayer"),head=document.getElementsByTagName("head")[0],quitCloseButton=document.getElementById("quit"),saveQuitCloseButton=document.getElementById("save-quit"),saveState=document.getElementById("save-state"),windowCloseContainer=document.getElementById("window-close"),windowClose=document.getElementById("window-close-button"),windowMax=document.getElementById("window-maximize"),windowMin=document.getElementById("window-minimize"),chrome.storage.local.get("tempFileEntry",function(a){void 0!=a.tempFileEntry?chrome.fileSystem.restoreEntry(a.tempFileEntry,function(a){fileEntry=a,chrome.storage.local.remove("tempFileEntry"),fileEntry.file(function(a){var b=new FileReader;b.onload=function(a){markdown.value=a.target.result,markdownSaved=markdown.value,contentChanged(),nameDiv.innerHTML=fileName(fileEntry.fullPath)+"&nbsp;-",windowTitle.innerHTML=fileName(fileEntry.fullPath)+" - Mado"},b.readAsText(a)},errorHandler)}):markdownSaved=void 0}),newDisplaySize(),$(newButton).on("click",newWindow),Mousetrap.bind(["command+n","ctrl+n"],function(){return newWindow(),!1}),$(openButton).on("click",openFileButton),Mousetrap.bind(["command+o","ctrl+o"],function(){return openFileButton(),!1}),$(saveButton).on("click",saveFile),Mousetrap.bind(["command+s","ctrl+s"],function(){return saveFile(),!1}),$(saveAsButton).on("click",saveAsFile),Mousetrap.bind(["command+shift+s","ctrl+shift+s"],function(){return saveAsFile(),!1}),$(exportButton).on("click",exportFileHTML),$(printButton).on("click",function(){window.print()}),Mousetrap.bind(["command+p","ctrl+p"],function(){return window.print(),!1}),dragAndDropManager=new DnDManager("body",function(a){openDraggedFile(a.items[0].webkitGetAsEntry())}),setEditorSyntax(),$(charsDiv).css("display","none"),chrome.storage.local.get("firstLaunch",function(a){void 0==a.firstLaunch&&(void 0==markdownSaved&&(markdown.value=firstMessage,contentChanged()),chrome.storage.local.set({firstLaunch:!1}))}),$(markdown).focus(),$(markdown).on("input propertychange",function(){contentChanged(),newInputForStats()}),$(markdown).on("paste",newInputForStats),$(markdown).keydown(function(a){9==a.keyCode&&a.preventDefault()}),$("#html-conversion").on("click","a",function(a){-1!=a.currentTarget.href.indexOf("chrome-extension://")&&(a.preventDefault(),""!=a.currentTarget.hash&&0!=$(a.currentTarget.hash).length&&$("#html-conversion").scrollTop($(a.currentTarget.hash).position().top))}),$(charsDiv).on("click",counterSelection),$(wordsDiv).on("click",counterSelection),$("#html-conversion").on("mouseenter","a",function(a){linkUrlSpan.innerHTML=-1==a.currentTarget.href.indexOf("chrome-extension://")?a.currentTarget.href:a.currentTarget.hash,linkUrlSpan.className="show"}),$("#html-conversion").on("mouseleave","a",function(){linkUrlSpan.className=""}),Mousetrap.bind(["command+h","ctrl+h"],function(){return $(helpButton).click(),!1}),$(help).keyup(function(a){27==a.keyCode&&$(helpButton).click()}),$(help).on("input propertychange",displayAnswers),$("#result-switch-1, #result-switch-2, #result-switch-3").on("click",function(a){switchResult(a.target.id.substr(a.target.id.length-1))}),$("#answer-1, #answer-2, #answer-3, #example-1, #example-2, #example-3").mutate("height",setResultsHeight),$(imageBrowser).on("click",loadImage),$(galleriesButton).on("click",chooseGalleries),$(altInput).keyup(function(a){switch(a.keyCode){case 13:applyImage();break;case 27:cancelImage();break;default:modifyImage()}}),$(cancelImageButton).on("click",cancelImage),Mousetrap.bind(["command+k","ctrl+k"],function(){return $(linkButton).click(),!1}),$(urlInput).keyup(function(a){switch(a.keyCode){case 13:applyLink();break;case 27:cancelLink();break;default:modifyLink()}}),$(hypertextInput).keydown(function(a){9==a.keyCode&&(a.preventDefault(),$(urlInput).select())}),$(hypertextInput).keyup(function(a){switch(a.keyCode){case 13:applyLink();break;case 27:cancelLink();break;default:modifyLink()}}),$(cancelLinkButton).on("click",cancelLink),$(settingsLine).on("click",function(){moreWindow("more/settings.html")}),$(qAndALine).on("click",function(){moreWindow("more/qanda.html")}),$(shortcutsLine).on("click",function(){moreWindow("more/shortcuts.html")}),$(aboutLine).on("click",function(){moreWindow("more/about.html")}),$(onlineImageUrlInput).keyup(function(a){switch(a.keyCode){case 13:applyOnlineImage();break;case 27:cancelOnlineImage();break;default:modifyOnlineImage()}}),$(onlineImageAltInput).keydown(function(a){9==a.keyCode&&(a.preventDefault(),$(onlineImageUrlInput).select())}),$(onlineImageAltInput).keyup(function(a){switch(a.keyCode){case 13:applyOnlineImage();break;case 27:cancelOnlineImage();break;default:modifyOnlineImage()}}),$(cancelOnlineImageButton).on("click",cancelOnlineImage),displayRecentFiles(),chrome.app.window.current().getBounds().width<1600&&addTopbarLabels(),$(markdown).on("scroll",function(){$(markdown).is(":hover")&&asyncScroll("markdown")}),$(conversionDiv).on("scroll",function(){$(conversionDiv).is(":hover")&&asyncScroll("HTML")}),navigator.onLine&&initStats(),getStyle(),$(homeRadio).on("click",function(){setStyle("home")}),$(clinicRadio).on("click",function(){setStyle("clinic")}),$(tramwayRadio).on("click",function(){setStyle("tramway")}),initActivation(),$(switchToMD).on("click",function(){activate(this.id,"markdown-view")}),$(switchToBoth).on("click",function(){activate(this.id,"normal")}),$(switchToHTML).on("click",function(){activate(this.id,"conversion-view")}),Mousetrap.bind(["command+alt+left","ctrl+alt+left"],function(){return switchShortcuts("left"),!1}),Mousetrap.bind(["command+alt+right","ctrl+alt+right"],function(){return switchShortcuts("right"),!1}),determineFrame(),lastBounds=chrome.app.window.current().getBounds(),$(quitCloseButton).on("click",quitCloseWindow),$(saveQuitCloseButton).on("click",saveQuitCloseWindow),$(windowClose).on("click",closeWindow),Mousetrap.bind(["command+w","ctrl+w"],function(){return closeWindow(),!1}),$(windowMax).on("click",maximizeWindow),$(windowMin).on("click",minimizeWindow)};var recentButton,recentFilesDisplayer,recentFilesContainer,footerHelp,chromeLocalFile="",fileInLoading,nameContainer={},recentFiles=["recentFile1","recentFile2","recentFile3","recentFile4","recentFile5","recentFile6","recentFile7","recentFileId1","recentFileId2","recentFileId3","recentFileId4","recentFileId5","recentFileId6","recentFileId7"],atTheBottom,service,tracker,markdownInputs=0,launchDate=new Date,stylesButton,stylesDisplayer,clinicRadio,homeRadio,tramwayRadio,madoFooter,switchCursor,switchToBoth,switchToHTML,switchToMD,workspace,previousSize,switchButtons=[],cancelCloseButton,closeDisplayer,head,lastBounds,markdownSaved,quitCloseButton,saveQuitCloseButton,saveState,frameStylesheetLink=document.createElement("link"),windowCloseContainer,windowClose,windowMax,windowMin,operatingSystem;chrome.app.window.current().onBoundsChanged.addListener(function(){chrome.app.window.current().getBounds().width<1160&&"switch-button activated"==switchToBoth.className?switchToMD.click():chrome.app.window.current().getBounds().width>=1160&&lastBounds.width<1160&&switchToBoth.click(),chrome.app.window.current().getBounds().width<1600&&lastBounds.width>=1600?addTopbarLabels():chrome.app.window.current().getBounds().width>=1600&&lastBounds.width<1600&&removeTopbarLabels(),lastBounds=chrome.app.window.current().getBounds()});